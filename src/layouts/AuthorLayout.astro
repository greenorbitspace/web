---
import BlogPostList from '../components/BlogPostList.jsx';
import crypto from 'crypto';

const { author, posts = [] } = Astro.props;

function getGravatarUrl(email) {
  if (!email) return null;
  const hash = crypto.createHash('md5').update(email.trim().toLowerCase()).digest('hex');
  return `https://www.gravatar.com/avatar/${hash}?s=120&d=identicon`;
}

const avatarUrl = author.gravatar && author.email
  ? getGravatarUrl(author.email)
  : author.avatar || '/images/default-author.png';
---

<main class="max-w-3xl mx-auto px-4 py-12">
  <section class="flex items-center space-x-6 mb-12">
    <img
      src={avatarUrl}
      alt={`Avatar of ${author.name}`}
      class="rounded-full w-24 h-24 object-cover border border-gray-300 dark:border-gray-600"
      loading="lazy"
      decoding="async"
    />
    <div>
      <h1 class="text-4xl font-bold">{author.name}</h1>
      {author.role && <p class="text-gray-600 dark:text-gray-400 mt-1">{author.role}</p>}
      {author.bio && <p class="mt-4 leading-relaxed text-gray-700 dark:text-gray-300">{author.bio}</p>}

      <div class="flex space-x-4 mt-4 text-sm">
        {author.website && (
          <a
            href={author.website}
            target="_blank"
            rel="noopener noreferrer"
            class="text-blue-600 hover:underline"
          >
            Website
          </a>
        )}
        {author.twitter && (
          <a
            href={`https://twitter.com/${author.twitter}`}
            target="_blank"
            rel="noopener noreferrer"
            class="text-blue-600 hover:underline"
          >
            Twitter
          </a>
        )}
        {author.linkedin && (
          <a
            href={`https://linkedin.com/in/${author.linkedin}`}
            target="_blank"
            rel="noopener noreferrer"
            class="text-blue-600 hover:underline"
          >
            LinkedIn
          </a>
        )}
      </div>
    </div>
  </section>

  <section>
    <h2 class="text-3xl font-semibold mb-6">Articles by {author.name}</h2>

    <BlogPostList posts={posts} filterByAuthor={author.slug} />
  </section>
</main>