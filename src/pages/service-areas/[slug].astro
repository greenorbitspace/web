---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import CTA from "../../components/CTA.jsx";

import cities from "../../data/cities.json";

// ---------------------------------
// 1. Generate static paths for all cities
// ---------------------------------
export async function getStaticPaths() {
  return Object.keys(cities).map((slug) => ({
    params: { slug },
  }));
}

// ---------------------------------
// 2. Get city data for current slug
// ---------------------------------
const { slug } = Astro.params;
const cityData = cities[slug];

if (!cityData) {
  throw new Error(`No service area found for slug: ${slug}`);
}

// Destructure all city fields
const {
  h1,
  metaDescription,
  keywords = [],
  description,
  whyLocalMatters,
  howWeHelp = [],
  localOpportunities = [],
  spaceConnection,
  recommendedSections = [],
  featuredImage = "/images/default-featured.jpg"
} = cityData;

const pageTitle = h1.replace(/Digital.*$/, "").trim();
---

<Layout title={pageTitle} description={metaDescription} keywords={keywords.join(", ")}>
  <Header />

  <!-- Hero Section with featured image -->
  <section
    class="relative w-full h-[400px] sm:h-[500px] lg:h-[600px] flex items-center justify-center overflow-hidden text-white mb-16"
  >
    <div
      class="absolute inset-0 bg-cover bg-center"
      style={`background-image: url(${featuredImage});`}
      aria-hidden="true"
    />
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="relative z-10 text-center px-4 sm:px-6 lg:px-8 max-w-4xl space-y-4">
      <h1 class="text-5xl sm:text-6xl font-extrabold drop-shadow-lg">{pageTitle}</h1>
      <p class="text-xl sm:text-2xl drop-shadow">{metaDescription}</p>
    </div>
  </section>

  <main class="container-custom max-w-4xl mx-auto space-y-12">

    <!-- Overview -->
    <section class="space-y-4">
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Overview</h2>
      <p class="text-gray-700 dark:text-gray-300">{description}</p>
    </section>

    <!-- Why Local Matters -->
    {whyLocalMatters && (
      <section class="space-y-4">
        <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Why Local Matters</h2>
        <p class="text-gray-700 dark:text-gray-300">{whyLocalMatters}</p>
      </section>
    )}

    <!-- How We Help -->
    {howWeHelp.length > 0 && (
      <section class="space-y-4">
        <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">How Green Orbit Helps</h2>
        <ul class="list-disc pl-6 text-gray-700 dark:text-gray-300 space-y-2">
          {howWeHelp.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </section>
    )}

    <!-- Local Opportunities -->
    {localOpportunities.length > 0 && (
      <section class="space-y-4">
        <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Local Opportunities</h2>
        <ul class="list-disc pl-6 text-gray-700 dark:text-gray-300 space-y-2">
          {localOpportunities.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </section>
    )}

    <!-- Space Connection -->
    {spaceConnection && (
      <section class="space-y-4">
        <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Space Connection</h2>
        <p class="text-gray-700 dark:text-gray-300">{spaceConnection}</p>
      </section>
    )}

  </main>
  
    <!-- Recommended Actions / CTA -->
    {recommendedSections.length > 0 && (
      <section class="space-y-4">
        <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">Recommended Actions</h2>
        <ul class="list-decimal pl-6 text-gray-700 dark:text-gray-300 space-y-2">
          {recommendedSections.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
        <div class="mt-6">
          <CTA text={`Book a ${pageTitle} audit`} link="/service-catalogue#audits" client:load />
        </div>
      </section>
    )}

  <Footer />
</Layout>