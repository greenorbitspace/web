---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import HeroSection from '../../components/HeroSection.astro';
import CTA from '../../components/CTA.jsx';

// Import all Markdown files from the sectors content folder
const sectors = await Astro.glob('../../content/sectors/*.md');

// Import all case studies for linking
const caseStudies = await Astro.glob('../../content/case-studies/*.md');

// Sort sectors alphabetically
sectors.sort((a, b) => a.frontmatter.name.localeCompare(b.frontmatter.name));
---

<Layout title="Sectors">
  <Header />

  <main class="py-8">
    <HeroSection
      title="Sectors"
      description="Explore how Green Orbit Digital helps organisations across different sectors achieve measurable results and sustainable growth."
    />

    <section class="py-16 bg-white dark:bg-primary-500">
      <div class="container-custom space-y-24">
        {sectors.length > 0 ? (
          sectors.map((sector, idx) => {
            const {
              name = 'Untitled Sector',
              description = '',
              featuredImage = '/images/default-featured.jpg',
              slug,
              relatedCaseStudies = [],
            } = sector.frontmatter;

            const isEven = idx % 2 === 0;
            const sectorUrl = slug ? `/sectors/${slug}` : '#';

            return (
              <div key={name} class="group">
                <div class={`flex flex-col md:flex-row ${!isEven ? 'md:flex-row-reverse' : ''} gap-12 items-center`}>
                  {/* Text Content */}
                  <div class="md:w-1/2">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">{name}</h2>
                    {description && <p class="text-gray-600 dark:text-white mb-6">{description}</p>}

                    {relatedCaseStudies.length > 0 && (
                      <div class="flex flex-col gap-3 mb-4">
                        {relatedCaseStudies.map((slug) => {
                          const study = caseStudies.find(c => c.frontmatter.slug === slug);
                          if (!study) return null;
                          return (
                            <a
                              href={`/case-studies/${study.frontmatter.slug}`}
                              class="text-accent-500 font-semibold underline"
                            >
                              {study.frontmatter.title}
                            </a>
                          );
                        })}
                      </div>
                    )}

                    <a href={sectorUrl} class="btn-primary mt-2 inline-block">Learn More About Sector</a>
                  </div>

                  {/* Image */}
                  <div class="md:w-1/2 rounded-lg overflow-hidden shadow-xl">
                    <img
                      src={featuredImage}
                      alt={name}
                      class="w-full h-64 sm:h-80 lg:h-96 object-cover"
                    />
                  </div>
                </div>
              </div>
            );
          })
        ) : (
          <p class="text-white text-center py-12">No sectors are available at the moment.</p>
        )}
      </div>
    </section>

    <!-- CTA Section -->
    <section class="w-full bg-secondary-500 py-16 text-white text-center">
      <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-accent-500 mb-4">Request Your Audit</h2>
        <p class="text-gray-700 dark:text-white mb-6">
          Take the next step in diagnosing and optimising your digital presence sustainably. Explore options and book an audit tailored to your business needs.
        </p>
        <CTA text="Explore Audit Options" link="/service-catalogue#audits" client:load />
      </div>
    </section>
  </main>

  <Footer />
</Layout>