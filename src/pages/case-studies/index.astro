---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import HeroSection from '../../components/HeroSection.astro';
import CTA from '../../components/CTA.jsx';

// Import all Markdown files from the case-studies folder
const caseStudies = await Astro.glob('../../content/case-studies/*.md');

// Sort by pubdate descending
caseStudies.sort((a, b) => {
  const dateA = a.frontmatter.pubdate ? new Date(a.frontmatter.pubdate) : new Date(0);
  const dateB = b.frontmatter.pubdate ? new Date(b.frontmatter.pubdate) : new Date(0);
  return dateB - dateA;
});
---

<Layout title="Case Studies">
  <Header />

  <main class="py-8">
    <HeroSection 
      title="Case Studies"
      description="See how our customers are achieving success with Green Orbit Digital"
    />

    <section class="py-16 bg-white dark:bg-primary-500">
      <div class="container-custom">
        {caseStudies.length > 0 ? (
          caseStudies.map((study, idx) => {
            const {
              title = 'Untitled Case Study',
              summary = '',
              category = '',
              featuredImage = '/images/default-featured.jpg',
              metrics = [],
              slug
            } = study.frontmatter;

            const isEven = idx % 2 === 0;
            const studyUrl = slug ? `/case-studies/${slug}` : '#';

            return (
              <div key={slug} class="mb-24 group">
                {/* Use flex instead of grid for alternating layouts */}
                <div class={`flex flex-col md:flex-row ${!isEven ? 'md:flex-row-reverse' : ''} gap-12 items-center mb-12`}>
                  <div class="md:w-1/2">
                    {category && (
                      <span class="inline-block px-4 py-1 rounded-full bg-secondary-100 dark:bg-accent-500 text-secondary-600 dark:text-white font-medium text-sm mb-4">
                        {category}
                      </span>
                    )}
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">{title}</h2>
                    {summary && <p class="text-gray-600 dark:text-gray-300 mb-6">{summary}</p>}

                    {metrics.length > 0 && (
                      <div class="flex flex-wrap gap-4 mb-6">
                        {metrics.map((metric, mIdx) => (
                          <div class="flex items-center" key={mIdx}>
                            <svg class="w-5 h-5 text-primary-600 dark:text-accent-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            <span class="text-gray-700 dark:text-gray-300">{metric}</span>
                          </div>
                        ))}
                      </div>
                    )}

                    <a href={studyUrl} class="btn-primary mt-2 inline-block">Read Full Case Study</a>
                  </div>

                  <div class="md:w-1/2 rounded-lg overflow-hidden shadow-xl">
                    <img src={featuredImage} alt={title} class="w-full h-auto" />
                  </div>
                </div>
              </div>
            );
          })
        ) : (
          <p class="text-white text-center py-12">No case studies are available at the moment.</p>
        )}
      </div>
    </section>
  </main>
    <!-- Request Audit CTA -->
    <section class="w-full bg-secondary-500 py-16 text-white text-center">
          <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-bold text-accent-500 mb-4">Request Your Audit</h2>
      <p class="text-gray-700 dark:text-white mb-6">Take the next step in diagnosing and optimising your digital presence sustainably. Explore options and book an audit tailored to your business needs.</p>
      <CTA text="Explore Audit Options" link="/service-catalogue#audits" client:load />
      </div>
    </section>
  <Footer />
</Layout>