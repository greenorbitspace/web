---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import HeroSection from '../../components/HeroSection.astro';
import CampaignsList from '../../components/CampaignsList.jsx';
import { getCollection } from 'astro:content';

// Load campaigns
const campaigns = await getCollection('campaigns');

// Standardise format for compatibility
const formattedCampaigns = campaigns.map(entry => ({
  ...entry,
  data: {
    ...entry.data,
    contentType: 'campaign'
  }
}));

// Sort by logical calendar order
const sortedCampaigns = formattedCampaigns.sort((a, b) => {
  const getMonthNumber = (m) => {
    const str = m?.toLowerCase?.() ?? '';
    const months = [
      'january', 'february', 'march', 'april', 'may', 'june',
      'july', 'august', 'september', 'october', 'november', 'december'
    ];
    const index = months.indexOf(str);
    return index === -1 ? 999 : index;
  };

  return getMonthNumber(a.data.month) - getMonthNumber(b.data.month);
});
---

<Layout title="Campaigns" description="Explore campaigns and international awareness events.">
  <Header />

  <main class="py-12 max-w-6xl mx-auto px-4">
    <HeroSection 
      title="Campaigns" 
      description="Explore key international days, events, and campaigns that highlight sustainability, space for good, and global goals." 
    />

    <CampaignsList client:load campaigns={sortedCampaigns} />
  </main>

  <Footer />
</Layout>