---
interface Props {
  portalId: string;
  formId: string;
  region?: string;
  domId?: string;
}

const { portalId, formId, region = "eu1", domId } = Astro.props;
const targetId = domId ?? `hs-form-${formId}-${Math.random().toString(36).slice(2, 8)}`;
---

<div id={targetId}></div>

<script is:inline client:load>
(() => {
  const targetId = "${targetId}";
  const portalId = "${portalId}";
  const formId = "${formId}";
  const region = "${region}";

  // Apply Tailwind classes after the form is rendered
  function styleForm() {
    const form = document.querySelector(`#${targetId} form`);
    if (!form) return;

    // Inputs, textareas, selects
    form.querySelectorAll("input, textarea, select").forEach(el => {
      el.removeAttribute("style");
      el.className = "w-full rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2 mb-4 text-gray-900 dark:text-white bg-white dark:bg-gray-800 focus:ring-2 focus:ring-green-500 focus:outline-none";
    });

    // Labels
    form.querySelectorAll("label").forEach(el => {
      el.removeAttribute("style");
      el.className = "block mb-2 font-medium text-gray-700 dark:text-gray-200";
    });

    // Submit button
    const submit = form.querySelector(".hs-button");
    if (submit) {
      submit.removeAttribute("style");
      submit.className = "inline-flex items-center justify-center rounded-xl bg-green-600 px-6 py-3 font-semibold text-white shadow-md hover:bg-green-700 transition";
    }

    // Error messages
    form.querySelectorAll(".hs-error-msg").forEach(el => {
      el.className = "text-sm text-red-600 mt-1";
    });
  }

  // Create the HubSpot form
  function createHubspotForm() {
    if (!window.hbspt?.forms?.create) return;
    window.hbspt.forms.create({
      portalId,
      formId,
      region,
      target: "#" + targetId,
      css: "" // disable HubSpot default styles
    });

    setTimeout(styleForm, 300); // give form time to render
  }

  // Load HubSpot embed script if needed
  if (!window.hbspt) {
    const s = document.createElement("script");
    s.src = `https://js-${region}.hsforms.net/forms/embed/v2.js`;
    s.async = true;
    s.defer = true;
    s.onload = createHubspotForm;
    document.head.appendChild(s);
  } else {
    createHubspotForm();
  }
})();
</script>