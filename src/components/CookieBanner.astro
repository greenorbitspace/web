---
// components/CookieBanner.astro
const consentCookieName = 'analytics_consent';
const showBanner = !Astro.cookies.get(consentCookieName)?.value;
---

{showBanner && (
  <div
    id="cookie-banner"
    class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:bottom-4 bg-white text-black border border-gray-200 shadow-xl rounded-xl max-w-md mx-auto p-4 z-50 transition-all animate-fade-in"
    role="dialog"
    aria-live="polite"
    aria-label="Cookie consent banner"
  >
    <p class="text-sm mb-3">
      We use cookies to analyse site traffic and enhance your experience. You can manage your preferences at any time. See our <a href="/privacy-policy" class="underline">Privacy Policy</a>.
    </p>
    <div class="flex justify-end gap-2">
      <button
        onclick="handleCookieDecline()"
        class="px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg"
      >
        Decline
      </button>
      <button
        onclick="handleCookieAccept()"
        class="px-3 py-1 text-sm bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg"
      >
        Accept
      </button>
    </div>
  </div>
)}

<style>
  @keyframes fade-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in {
    animation: fade-in 0.4s ease-out;
  }
</style>

<script>
  function setConsent(value) {
    const days = 365;
    const date = new Date();
    date.setTime(date.getTime() + (days*24*60*60*1000));
    document.cookie = "analytics_consent=" + value + "; path=/; expires=" + date.toUTCString();

    const banner = document.getElementById('cookie-banner');
    if (banner) banner.remove();

    if (value === "true" && typeof initGA === 'function') {
      initGA();
    }
  }

  function handleCookieAccept() {
    setConsent("true");
  }

  function handleCookieDecline() {
    setConsent("false");
  }
</script>