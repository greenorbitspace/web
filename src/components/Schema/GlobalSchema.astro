---
import '../styles/global.css';
import '../styles/transitions.css';
import { getGlobalSchema } from '../components/Schema/GlobalSchema.astro';
import Seo from '../components/Seo.astro';
import Analytics from '../components/Analytics.astro';
import CookieBanner from '../components/CookieBanner.astro';

export interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  canonical?: string;
  twitter?: {
    title?: string;
    description?: string;
    image?: string;
  };
  schema?: Record<string, any>;
}

const { title, description, ogImage, canonical, twitter, schema } = Astro.props;

// Merge global schema with page-specific schema (if provided)
const mergedSchema = [...getGlobalSchema()];
if (schema) {
  if (Array.isArray(schema)) {
    mergedSchema.push(...schema);
  } else {
    mergedSchema.push(schema);
  }
}
---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth" x-data="{ darkMode: localStorage.theme === 'dark' || (!localStorage.theme && window.matchMedia('(prefers-color-scheme: dark)').matches) }" x-bind:class="{ 'dark': darkMode }">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <Seo title={title} description={description} ogImage={ogImage} canonical={canonical} twitter={twitter} />

    <!-- Inject merged schema -->
    <script type="application/ld+json" set:html={JSON.stringify(mergedSchema)} />

    {Astro.head}

    <Analytics
      gtmId={import.meta.env.PUBLIC_GTM_ID}
      ga4Id={import.meta.env.PUBLIC_GA4_ID}
      hubspotId={import.meta.env.PUBLIC_HUBSPOT_ID}
      hotjarId={import.meta.env.PUBLIC_HOTJAR_ID}
      hotjarVersion={import.meta.env.PUBLIC_HOTJAR_VERSION}
      brevoSiteId={import.meta.env.PUBLIC_BREVO_SITE_ID}
      ticketTailorTracking={import.meta.env.PUBLIC_TICKET_TAILOR}
    />

    <script type="module" src="https://unpkg.com/alpinejs@3.14.2/dist/cdn.min.js" defer></script>
  </head>

  <body class="antialiased bg-white dark:bg-primary-500 text-secondary-900 dark:text-secondary-100 transition-colors duration-300">
    <main id="page-wrapper" class="page-wrapper" role="main" tabindex="-1">
      <slot />
    </main>

    <CookieBanner />
  </body>
</html>