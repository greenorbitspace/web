---
import organisations from "../../data/organisations.json";
import brands from "../../data/schema/brands.json";
import socials from "../../data/schema/socials.json";
import contact from "../../data/schema/contact.json";
import founders from "../../data/schema/founders.json";
import areas from "../../data/schema/areas.json";
import knowledge from "../../data/schema/knowledge.json";
import profiles from "../../data/schema/profiles.json";
import services from "../../data/schema/services.json";
import webpages from "../../data/schema/webpages.json";
import blog from "../../data/schema/blog.json";

// --- Safe JSON defaults ---
const safeFounders = founders || [];
const safeContact = contact || {};
const safeAreas = areas || [];
const safeKnowledge = knowledge || [];
const safeBrands = brands || [];
const safeServices = services || [];
const safeWebpages = webpages || [];
const safeBlog = blog || [];

// --- Filter member or partner organisations ---
const memberOrgs = organisations
  .filter(org => ["member", "partner"].includes(org.Type))
  .map(org => ({
    "@type": "Organization",
    name: org.Organisation,
    url: org.URL,
    description: org.Description || undefined,
    logo: org.logo || undefined
  }));

// --- Flatten profiles and build unique sameAs links ---
const flattenedProfiles = Object.values(profiles.profiles || {}).flat();
const sameAsLinks = Array.from(
  new Set([
    ...socials.map(s => s?.url).filter(Boolean),
    ...flattenedProfiles.map(p => p?.url).filter(Boolean)
  ])
);

// --- Build Organization schema ---
const orgSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": "https://greenorbit.space/#organization",
  name: "Green Orbit Digital",
  alternateName: "Green Orbit",
  url: "https://greenorbit.space",
  logo: "https://greenorbit.space/images/logo.png",
  foundingDate: "2023-10-12",
  legalName: "Green Orbit Digital Ltd",
  description: "Green Orbit Digital is a Leicester-based agency specialising in sustainable marketing for the space sector. We help space organisations grow through strategic SEO, content, PR, and digital sustainability practices.",
  slogan: "Sustainable marketing for the space sector.",
  keywords: [
    "sustainable marketing",
    "space sector marketing",
    "digital sustainability",
    "ethical marketing",
    "B2B SEO",
    "ESG strategy",
    "HubSpot CRM",
    "GA4",
    "content marketing",
    "space industry branding"
  ],
  founder: safeFounders.length ? safeFounders : undefined,
  contactPoint: safeContact.contactPoint?.length ? safeContact.contactPoint : undefined,
  address: Object.keys(safeContact.address || {}).length ? safeContact.address : undefined,
  geo: Object.keys(safeContact.geo || {}).length ? safeContact.geo : undefined,
  sameAs: sameAsLinks.length ? sameAsLinks : undefined,
  areaServed: safeAreas.length ? safeAreas : undefined,
  memberOf: memberOrgs.length ? memberOrgs : undefined,
  knowsAbout: safeKnowledge.length ? safeKnowledge : undefined,
  brand: safeBrands.length ? safeBrands : undefined,
  awards: [
    "Shortlisted: Best Sustainable Campaign – UK Space Marketing Awards 2024",
    "Nominee: Ethical Digital Agency of the Year – Tech for Good Awards 2023"
  ],
  hasCredential: [
    {
      "@type": "EducationalOccupationalCredential",
      name: "B Corp Pending",
      credentialCategory: "Sustainability",
      url: "https://www.bcorporation.net/"
    }
  ],
  makesOffer: safeServices.length ? safeServices : undefined,
  hasPart: safeWebpages.length ? safeWebpages : undefined,
  publishes: safeBlog.length ? safeBlog : undefined,
  publishingPrinciples: "https://greenorbit.space/",
  isAccessibleForFree: true,
  hasPOS: {
    "@type": "Place",
    name: "Green Orbit Digital HQ",
    address: {
      "@type": "PostalAddress",
      addressLocality: "Leicester",
      addressCountry: "GB"
    }
  },
  interactionStatistic: {
    "@type": "InteractionCounter",
    interactionType: "https://schema.org/SubscribeAction",
    userInteractionCount: 2500
  }
};
---

<script type="application/ld+json" is:inline>
{JSON.stringify(orgSchema)}
</script>