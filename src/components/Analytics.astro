---
const { ga4Id = import.meta.env.PUBLIC_GA4_ID } = Astro.props;
---

<script is:inline>
if (window.CookieYes?.consent?.analytics && ga4Id && ga4Id.trim() !== "") {
  // Load gtag.js
  const existing = document.querySelector(`script[src*="${ga4Id.trim()}"]`);
  if (!existing) {
    const gtagScript = document.createElement('script');
    gtagScript.async = true;
    gtagScript.src = `https://www.googletagmanager.com/gtag/js?id=${ga4Id.trim()}`;
    document.head.appendChild(gtagScript);
  }

  // Initialize GA4
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', ga4Id.trim());
}

// Optional: Listen for consent if given later
window.addEventListener('cookies:analytics-accepted', () => {
  if (ga4Id && ga4Id.trim() !== "") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', ga4Id.trim());
  }
});
</script>